---
import BaseLayout from '../layouts/BaseLayout.astro';
import CategoryNav from '../components/CategoryNav.astro';
import ToolCard from '../components/ToolCard.astro';
import PurposeList from '../components/PurposeList.astro';
import type { ToolsData, Category, Subcategory } from '../types';
import toolsData from '@data/tools.json';

const { meta, categories } = toolsData as ToolsData;
---

<BaseLayout title={meta.title} description={meta.subtitle}>
  <div class="page-layout">
    <aside class="sidebar">
      <CategoryNav categories={categories} />
    </aside>

    <article class="main-content">
    <section class="intro">
      <h2>Overview</h2>
      <p>{meta.introduction.overview}</p>

      <h3>Purpose</h3>
      <PurposeList items={meta.introduction.purpose} variant="arrow" />
    </section>

    <section class="categories">
      <h2>Categories</h2>

      {categories.map((category: Category) => (
        <div class="category" id={category.id}>
          <h3>{category.name}</h3>
          {category.description && <p class="category-description">{category.description}</p>}

          {category.tools && category.tools.length > 0 && (
            <div class="tools-grid">
              {category.tools.map((tool) => (
                <ToolCard tool={tool} headingLevel="h4" />
              ))}
            </div>
          )}

          {category.subcategories && category.subcategories.length > 0 && (
            <div class="subcategories">
              {category.subcategories.map((subcategory: Subcategory) => (
                <div class="subcategory" id={subcategory.id}>
                  <h4>{subcategory.name}</h4>

                  {subcategory.tools && subcategory.tools.length > 0 && (
                    <div class="tools-grid">
                      {subcategory.tools.map((tool) => (
                        <ToolCard tool={tool} headingLevel="h5" />
                      ))}
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}
        </div>
      ))}
    </section>
  </article>
  </div>

  <style>
    .page-layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 1.5rem;
      align-items: start;
    }

    .sidebar {
      position: sticky;
      top: 5rem;
      max-height: calc(100vh - 6rem);
      overflow-y: auto;
    }

    .main-content {
      min-width: 0;
    }

    @media (max-width: 1024px) {
      .page-layout {
        grid-template-columns: 1fr;
      }

      .sidebar {
        position: relative;
        top: 0;
        max-height: none;
        overflow-y: visible;
      }
    }

    .intro {
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--color-hover);
      border-radius: 8px;
      border: 1px solid var(--color-border);
    }

    .intro h2 {
      margin-bottom: 0.75rem;
      color: var(--color-primary);
      font-size: 1.5rem;
    }

    .intro h3 {
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      font-size: 1.25rem;
    }

    .categories {
      margin-top: 1.5rem;
    }

    .categories > h2 {
      font-size: 1.75rem;
      margin-bottom: 1.5rem;
      color: var(--color-primary);
    }

    .category {
      margin-bottom: 3rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid var(--color-border);
      scroll-margin-top: 5rem;
    }

    .category:last-child {
      border-bottom: none;
    }

    .category > h3 {
      font-size: 1.5rem;
      margin-bottom: 0.75rem;
      color: var(--color-text);
    }

    .category-description {
      margin-bottom: 1rem;
      color: var(--color-secondary);
      font-size: 0.95rem;
    }

    .subcategory {
      margin-top: 1.5rem;
      margin-bottom: 1.5rem;
      scroll-margin-top: 5rem;
    }

    .subcategory h4 {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
      color: var(--color-primary);
    }

    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
  </style>
</BaseLayout>
